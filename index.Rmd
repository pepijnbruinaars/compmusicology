---
title: "Computational Musicology"
author: "Pepijn Bruinaars"
date: "2023-02-13"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: yeti
---
```{r, setup}
library(tidyverse)
library(plotly)
library(spotifyr)
library(compmus)

corpus_features <- get_playlist_audio_features("", "443PhwLJ63ci5JD8UpzNGf")
styled <- theme_bw() + 
  theme(
    plot.title = element_text(face = "bold", size = 12),
    legend.background = element_rect(
      fill = "white",
      linewidth = 4,
      colour = "white"),
    axis.ticks = element_line(colour = "grey70", linewidth = 0.2),
    panel.grid.major = element_line(colour = "grey70", linewidth = 0.2),
    panel.grid.minor = element_blank()
  )
```

### Introduction

This is my repository for the computational musicology course. During this course, I will be analyzing my personal [Spotify playlist](https://open.spotify.com/playlist/443PhwLJ63ci5JD8UpzNGf?si=373978fd923d44d5). It consists of 2466 songs and an aggregated playtime of 143 hours and 18 minutes. This playlist started somewhere back in 2015 or 2016 and therefore tells you a lot about what I was going through in my life at specific times. One could say it functions as some sort of diary.

I will analyze the playlist on 3 or 6-month splits (yet to be determined!). This can be done by looking at the `date_added` variables which are returned when a GET request is done to the <https://api.spotify.com/v1/playlists/playlist_id> URL. I can also make a comparison between my so-called Top Items and recent tracks in my playlist.

The tracks in this corpus are very representative of each period since my music taste varies based on various factors which also contribute to particular feelings, e.g. seasons and an everchanging music taste.

### (A)typical tracks in the playlist

Most of the songs in the playlist will fall into the EDM/Pop genres, with Future Bass being a particularly frequent occurrence. Tracks that might be very typical for this playlist could include:

1.  [Light - San Holo](https://open.spotify.com/track/74Ru27B7Jx8mBt5MGvGLLv?si=930bed36366a4aab)

2.  [Shelter - Porter Robinson, Madeon](https://open.spotify.com/track/2CgOd0Lj5MuvOqzqdaAXtS?si=f4e921fc2da242e5)

3.  [I See You - Illenium, Said The Sky](https://open.spotify.com/track/5zRljvpgY1elGsc18Qp3tC?si=f1dcbe32b64a41c2)

These are tracks, the likes of which can be found through-out the entire playlist.

Meanwhile, standout tracks could be:

1.  [peace treaty - dobi, Oyeme](https://open.spotify.com/track/4MGgwugitqH7Zx8fBVrqip?si=49ae7ed8021943a6)

2.  [Happiness - JÃ³nsi, Alex Somers](https://open.spotify.com/track/56izuMFp1xj6IGXOh5efiY?si=342e0143e98f472f)

3.  [There Will Be Tears - Mr Hudson](https://open.spotify.com/track/1cSITnw1sufeq4hEFX1q2N?si=806763d6dfe644dd)

These tracks are all a bit sadder than the usual and mark periods such as COVID-lockdowns in the Netherlands. The genres as identified by everynoise.com, change from Future Bass to the likes of post-rock and other less energetic genres.

### Danceability and tempo

```{r, Danceability, echo=FALSE}
corpus_features |> ggplot(aes(x = tempo, y = danceability, color=valence)) +
  geom_jitter(aes(alpha = 0.4)) +
  geom_smooth() +
  annotate("text", 200, 0.1, label = "Infinity") +
  scale_y_continuous(
    limits = c(0, 1)
  ) +
  styled +
  labs(
    x = "Tempo",
    y = "Danceability",
    colour = "Valence",
    title = "Danceability vs. Tempo and Valence",
  ) +
  guides(alpha = FALSE)
```

***

I've included a plot with the *tempo*, *danceability* and *valence* of my corpus plotted against each other. I find this graph particularly interesting, since it shows a couple of defining characteristics from the corpus.

Most future bass and house music has a tempo range of 128-160 BPM. These ranges can be spotted easily in the graph, since there are distinct vertical lines which enclose the entirety of this range, with the vast majority of tracks having a tempo between 128 and 160 BPM.

However, the plotted trend line shows that as the tempo increases past the 128 BPM threshold, danceability (on average) seems to decrease, which is unexpected. I excted the danceability to increase as the tempo increases. This is because most high tempo (\>160 BPM) in this corpus are hard-dance tracks, which I've always considered danceable (albeit in a very different way than dancing to other genres). One such outlier is the track in the bottom-right corner: [Infinity](https://open.spotify.com/track/4l549wQMFj7HvlB7jzQnck?si=4202ba0f613f4ade) by Sefa and D-Block & S-te-Fan. This is a french-core track with intense kicks, which I would define as a highly danceable track. I will look to find out what defines a danceable track to Spotify.

### Tempo Histogram

```{r, histogram}
corpus_features |> ggplot(aes(x = tempo)) + 
  theme_bw() + 
  geom_histogram(binwidth = 5)
```

***

I also included a histogram which shows the distribution of tempos, and confirms the statements I made above.

### Chromagram of Still Together

```{r, chromagram}
chroma <- get_tidy_audio_analysis("4pWXN0gyIOqxODSGGgAMr4") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

chroma |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
